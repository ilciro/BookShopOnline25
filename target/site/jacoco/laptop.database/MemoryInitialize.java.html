<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MemoryInitialize.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BookShopOnline25 Maven Webapp</a> &gt; <a href="index.source.html" class="el_package">laptop.database</a> &gt; <span class="el_source">MemoryInitialize.java</span></div><h1>MemoryInitialize.java</h1><pre class="source lang-java linenums">package laptop.database;

import laptop.controller.ControllerSystemState;
import laptop.model.raccolta.Giornale;
import laptop.model.raccolta.Libro;
import laptop.model.raccolta.Rivista;
import org.jetbrains.annotations.NotNull;

import java.io.*;
import java.nio.file.Files;
import java.nio.file.Path;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;

<span class="fc" id="L17">public class MemoryInitialize {</span>
    //class used for reduce duplication

    private static final String SERIALIZZAZIONEGIORNALE=&quot;memory/serializzazioneGiornale.ser&quot;;
    private static final String SERIALIZZAZIONELIBRO=&quot;memory/serializzazioneLibro.ser&quot;;
    private static final String SERIALIZZAZIONERIVISTA=&quot;memory/serializzazioneRivista.ser&quot;;
    private static final String GIORNALE=&quot;giornale&quot;;
    private static final String LIBRO=&quot;libro&quot;;
    private static final String RIVISTA=&quot;rivista&quot;;
<span class="fc" id="L26">    private static ArrayList&lt;Giornale&gt; listG=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L27">    private static ArrayList&lt;Libro&gt; listL=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L28">    private static ArrayList&lt;Rivista&gt; listR=new ArrayList&lt;&gt;();</span>


<span class="fc" id="L31">    private static final ControllerSystemState vis=ControllerSystemState.getInstance();</span>


    public boolean cancellaGiornale(Giornale g) throws IOException, ClassNotFoundException {


<span class="fc" id="L37">        boolean status=false;</span>
<span class="fc" id="L38">        listG=leggiDaFileGiornale(SERIALIZZAZIONEGIORNALE);</span>


<span class="fc bfc" id="L41" title="All 2 branches covered.">        for(int i=0;i&lt;listG.size();i++)</span>
        {
<span class="fc bfc" id="L43" title="All 2 branches covered.">            if(i== (g.getId()-1)) {</span>
<span class="fc" id="L44">                status = listG.remove(listG.get(i));</span>
            }
        }
<span class="fc" id="L47">        removeFile(SERIALIZZAZIONEGIORNALE,listG,new ArrayList&lt;&gt;(),new ArrayList&lt;&gt;());</span>

<span class="fc" id="L49">        return status;</span>
    }

    public boolean cancellaLibro(Libro l) throws IOException, ClassNotFoundException {

<span class="fc" id="L54">        boolean status=false;</span>
<span class="fc" id="L55">       listL=leggiDaFileLibro(SERIALIZZAZIONELIBRO);</span>


<span class="fc bfc" id="L58" title="All 2 branches covered.">        for(int i=0;i&lt;listL.size();i++)</span>
        {
<span class="fc bfc" id="L60" title="All 2 branches covered.">            if(i== (l.getId()-1)) {</span>
<span class="fc" id="L61">                status = listL.remove(listL.get(i));</span>
            }
        }
<span class="fc" id="L64">        removeFile(SERIALIZZAZIONELIBRO,new ArrayList&lt;&gt;(),listL,new ArrayList&lt;&gt;());</span>

<span class="fc" id="L66">        return status;</span>
    }

    public boolean cancellaRivista(Rivista r) throws IOException, ClassNotFoundException {

<span class="fc" id="L71">        boolean status=false;</span>
<span class="fc" id="L72">        listR=leggiDaFileRivista(SERIALIZZAZIONERIVISTA);</span>

<span class="fc bfc" id="L74" title="All 2 branches covered.">        for(int i=0;i&lt;listR.size();i++)</span>
        {
<span class="fc bfc" id="L76" title="All 2 branches covered.">            if(i== (r.getId()-1)) {</span>
<span class="fc" id="L77">                status = listR.remove(listR.get(i));</span>
            }
        }
<span class="fc" id="L80">        removeFile(SERIALIZZAZIONERIVISTA,new ArrayList&lt;&gt;(),new ArrayList&lt;&gt;(),listR);</span>

<span class="fc" id="L82">        return status;</span>
    }

    private void removeFile(String stringPath,ArrayList&lt;Giornale&gt; listG,ArrayList&lt;Libro&gt; listL,ArrayList&lt;Rivista&gt; listR) throws IOException {

<span class="fc" id="L87">        Path path = Path.of(stringPath);</span>
        try {
<span class="fc" id="L89">            Files.delete(path);</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">            if(!Files.exists(path))</span>
            {
<span class="fc" id="L92">                throw new IOException(&quot;file daily is deleted!!&quot;);</span>
            }
<span class="fc" id="L94">        }catch (IOException e)</span>
        {
<span class="fc bfc" id="L96" title="All 2 branches covered.">            if(!listG.isEmpty())</span>
            {
<span class="fc" id="L98">                Files.createFile(path);</span>
<span class="fc" id="L99">                try(FileOutputStream fos=new FileOutputStream(stringPath);</span>
<span class="fc" id="L100">                    ObjectOutputStream oos=new ObjectOutputStream(fos)){</span>
<span class="fc" id="L101">                    oos.writeObject(listG);</span>
                }
            }
<span class="fc bfc" id="L104" title="All 2 branches covered.">            if(!listL.isEmpty())</span>
            {
<span class="fc" id="L106">                Files.createFile(path);</span>
<span class="fc" id="L107">                try(FileOutputStream fos=new FileOutputStream(stringPath);</span>
<span class="fc" id="L108">                    ObjectOutputStream oos=new ObjectOutputStream(fos)){</span>
<span class="fc" id="L109">                    oos.writeObject(listL);</span>
                }
            }
<span class="fc bfc" id="L112" title="All 2 branches covered.">            if(!listR.isEmpty())</span>
            {
<span class="fc" id="L114">                Files.createFile(path);</span>
<span class="fc" id="L115">                try(FileOutputStream fos=new FileOutputStream(stringPath);</span>
<span class="fc" id="L116">                    ObjectOutputStream oos=new ObjectOutputStream(fos)){</span>
<span class="fc" id="L117">                    oos.writeObject(listR);</span>
                }
            }

<span class="nc" id="L121">        }</span>
<span class="fc" id="L122">    }</span>

    public void inizializza(String file) throws IOException, ClassNotFoundException {

<span class="pc bpc" id="L126" title="1 of 4 branches missed.">        switch (vis.getType())</span>
        {
            case GIORNALE-&gt;
            {
<span class="fc bfc" id="L130" title="All 2 branches covered.">                for(int i=1;i&lt;=12;i++) {</span>
<span class="fc" id="L131">                    Giornale g = getGiornale(i);</span>
<span class="fc" id="L132">                    listG.add(g);</span>
                }
<span class="fc" id="L134">                scriviInFile(file,listG,null,null);</span>
<span class="fc" id="L135">                leggiDaFileGiornale(file);</span>


<span class="fc" id="L138">            }</span>
            case LIBRO -&gt; {


<span class="fc bfc" id="L142" title="All 2 branches covered.">                for(int i=1;i&lt;=19;i++) {</span>


<span class="fc" id="L145">                    Libro l = getLibro(i);</span>

<span class="fc" id="L147">                    listL.add(l);</span>
                }
<span class="fc" id="L149">                scriviInFile(file,null,listL,null);</span>
<span class="fc" id="L150">                leggiDaFileLibro(file);</span>


<span class="fc" id="L153">            }</span>
            case RIVISTA -&gt;
            {
<span class="fc bfc" id="L156" title="All 2 branches covered.">                for(int i=1;i&lt;=5;i++)</span>
                {
<span class="fc" id="L158">                    Rivista r=getRivista(i);</span>
<span class="fc" id="L159">                    listR.add(r);</span>
                }
<span class="fc" id="L161">                scriviInFile(file,null,null,listR);</span>
<span class="fc" id="L162">                leggiDaFileRivista(file);</span>

            }

        }

<span class="fc" id="L168">    }</span>

    public boolean inserisci(Libro l,Giornale g,Rivista r,String file,String appoggio) throws IOException, ClassNotFoundException {
<span class="fc" id="L171">        Path path2 = Path.of(appoggio);</span>
<span class="fc" id="L172">        Path path1=Path.of(file);</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">        if(l!=null){</span>
<span class="pc bpc" id="L174" title="1 of 2 branches missed.">            if (vis.getTipoModifica().equals(&quot;im&quot;)) l.setId(vis.getIdLibro());</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            else if (vis.getTipoModifica().equals(&quot;insert&quot;)) l.setId(listL.size() + 1);</span>
<span class="fc" id="L176">            listL.add(l);</span>
            //scrivo lista in appoggio

<span class="fc" id="L179">            scriviInFile(appoggio,null,listL,null);</span>
<span class="fc" id="L180">            listL=leggiDaFileLibro(appoggio);</span>
<span class="fc" id="L181">            Files.delete(path1);</span>
<span class="fc" id="L182">            Files.createFile(path1);</span>
<span class="fc" id="L183">            scriviInFile(file,null,listL,null);</span>

<span class="fc" id="L185">            Files.delete(path2);</span>
        }
<span class="fc bfc" id="L187" title="All 2 branches covered.">        if(g!=null){</span>
<span class="fc bfc" id="L188" title="All 2 branches covered.">            if (vis.getTipoModifica().equals(&quot;im&quot;)) g.setId(vis.getIdGiornale());</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">            else if (vis.getTipoModifica().equals(&quot;insert&quot;)) g.setId(listG.size() + 1);</span>
<span class="fc" id="L190">            listG.add(g);</span>
            //scrivo lista in appoggio

<span class="fc" id="L193">            scriviInFile(appoggio,listG,null,null);</span>
<span class="fc" id="L194">            listG=leggiDaFileGiornale(appoggio);</span>
<span class="fc" id="L195">            Files.delete(path1);</span>
<span class="fc" id="L196">            Files.createFile(path1);</span>
<span class="fc" id="L197">            scriviInFile(file,listG,null,null);</span>

<span class="fc" id="L199">            Files.delete(path2);</span>
        }
<span class="fc bfc" id="L201" title="All 2 branches covered.">        if(r!=null){</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">            if (vis.getTipoModifica().equals(&quot;im&quot;)) r.setId(vis.getIdRivista());</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">            else if (vis.getTipoModifica().equals(&quot;insert&quot;)) r.setId(listR.size() + 1);</span>
<span class="fc" id="L204">            listR.add(r);</span>
            //scrivo lista in appoggio

<span class="fc" id="L207">            scriviInFile(appoggio,null,null,listR);</span>
<span class="fc" id="L208">            listR=leggiDaFileRivista(appoggio);</span>
<span class="fc" id="L209">            Files.delete(path1);</span>
<span class="fc" id="L210">            Files.createFile(path1);</span>
<span class="fc" id="L211">            scriviInFile(file,null,null,listR);</span>

<span class="fc" id="L213">            Files.delete(path2);</span>
        }
<span class="fc" id="L215">        return true;</span>
    }




    private void scriviInFile(String nome,ArrayList&lt;Giornale&gt; listaG,ArrayList&lt;Libro&gt; listaL,ArrayList&lt;Rivista&gt; listaR) throws IOException
    {
<span class="fc" id="L223">        try(FileOutputStream fos=new FileOutputStream(nome,true);</span>
<span class="fc" id="L224">            ObjectOutputStream oos=new ObjectOutputStream(fos)) {</span>
<span class="pc bpc" id="L225" title="1 of 4 branches missed.">            switch (vis.getType()) {</span>
<span class="fc" id="L226">                case GIORNALE -&gt; oos.writeObject(listaG);</span>
<span class="fc" id="L227">                case LIBRO -&gt; oos.writeObject(listaL);</span>
<span class="fc" id="L228">                case RIVISTA -&gt; oos.writeObject(listaR);</span>
<span class="nc" id="L229">                default -&gt; Logger.getLogger(&quot;scrivo in file&quot;).log(Level.SEVERE,&quot;type od object is wrong !!&quot;);</span>
            }
<span class="fc" id="L231">            oos.flush();</span>

        }



<span class="fc" id="L237">    }</span>
    @SuppressWarnings(&quot;unchecked&quot;)
    private ArrayList&lt;Giornale&gt; leggiDaFileGiornale(String nome) throws IOException ,ClassNotFoundException{
<span class="fc" id="L240">        try(FileInputStream fis=new FileInputStream(nome);</span>
<span class="fc" id="L241">            ObjectInputStream ois=new ObjectInputStream(fis)){</span>
<span class="fc" id="L242">            listG=(ArrayList&lt;Giornale&gt;) ois.readObject();</span>
        }
<span class="fc" id="L244">        return listG;</span>
    }
    @SuppressWarnings(&quot;unchecked&quot;)
    private ArrayList&lt;Libro&gt; leggiDaFileLibro(String nome) throws IOException ,ClassNotFoundException{
<span class="fc" id="L248">        try(FileInputStream fis=new FileInputStream(nome);</span>
<span class="fc" id="L249">            ObjectInputStream ois=new ObjectInputStream(fis)){</span>
<span class="fc" id="L250">            listL=(ArrayList&lt;Libro&gt;) ois.readObject();</span>
        }
<span class="fc" id="L252">        return listL;</span>
    }
    @SuppressWarnings(&quot;unchecked&quot;)
    private ArrayList&lt;Rivista&gt; leggiDaFileRivista(String nome) throws IOException ,ClassNotFoundException{
<span class="fc" id="L256">        try(FileInputStream fis=new FileInputStream(nome);</span>
<span class="fc" id="L257">            ObjectInputStream ois=new ObjectInputStream(fis)){</span>
<span class="fc" id="L258">            listR=(ArrayList&lt;Rivista&gt;) ois.readObject();</span>
        }
<span class="fc" id="L260">        return listR;</span>
    }


    public ArrayList&lt;Giornale&gt; listaGiornali(String file) throws IOException, ClassNotFoundException {
<span class="fc" id="L265">        return  leggiDaFileGiornale(file);</span>
    }

    public ArrayList&lt;Libro&gt; listaLibri(String file) throws IOException, ClassNotFoundException {
<span class="fc" id="L269">        return  leggiDaFileLibro(file);</span>
    }
    public ArrayList&lt;Rivista&gt; listaRiviste(String file) throws IOException, ClassNotFoundException {
<span class="fc" id="L272">        return  leggiDaFileRivista(file);</span>
    }



    private static @NotNull Giornale getGiornale(int i) throws IOException {
        String line;


<span class="fc" id="L281">        ArrayList&lt;String&gt; listaG = new ArrayList&lt;&gt;();</span>


<span class="fc" id="L284">        try (FileReader fileReader = new FileReader(&quot;src/main/resources/tmpFiles/giornale&quot; + i + &quot;.txt&quot;);</span>
<span class="fc" id="L285">             BufferedReader bufferedReader = new BufferedReader(fileReader)) {</span>
<span class="fc bfc" id="L286" title="All 2 branches covered.">            while ((line = bufferedReader.readLine()) != null) {</span>
<span class="fc" id="L287">                listaG.add(line);</span>

            }
        }
<span class="fc" id="L291">        Giornale g = new Giornale();</span>
<span class="fc" id="L292">        g.setTitolo(listaG.get(0));</span>
<span class="fc" id="L293">        g.setEditore(listaG.get(3));</span>
<span class="fc" id="L294">        g.setLingua(listaG.get(2));</span>
<span class="fc" id="L295">        g.setCategoria(listaG.get(1));</span>
<span class="fc" id="L296">        g.setDataPubb(LocalDate.parse(listaG.get(4)));</span>
<span class="fc" id="L297">        g.setCopieRimanenti(Integer.parseInt(listaG.get(5)));</span>
<span class="fc" id="L298">        g.setDisponibilita(Integer.parseInt(listaG.get(6)));</span>
<span class="fc" id="L299">        g.setPrezzo(Float.parseFloat(listaG.get(7)));</span>
<span class="fc" id="L300">        g.setId(Integer.parseInt(listaG.get(8)));</span>
<span class="fc" id="L301">        return g;</span>
    }

    private static @NotNull Libro getLibro(int i) throws FileNotFoundException ,IOException {
        String line;


<span class="fc" id="L308">        ArrayList&lt;String&gt; listaL = new ArrayList&lt;&gt;();</span>


<span class="fc" id="L311">        try (FileReader fileReader = new FileReader(&quot;src/main/resources/tmpFiles/libro&quot; + i + &quot;.txt&quot;);</span>
<span class="fc" id="L312">             BufferedReader bufferedReader = new BufferedReader(fileReader)) {</span>
<span class="fc bfc" id="L313" title="All 2 branches covered.">            while ((line = bufferedReader.readLine()) != null) {</span>
<span class="fc" id="L314">                listaL.add(line);</span>

            }
        }
<span class="fc" id="L318">            Libro l = new Libro();</span>
<span class="fc" id="L319">            l.setTitolo(listaL.get(0));</span>
<span class="fc" id="L320">            l.setNrPagine(Integer.parseInt(listaL.get(1)));</span>
<span class="fc" id="L321">            l.setCodIsbn(listaL.get(2));</span>
<span class="fc" id="L322">            l.setEditore(listaL.get(3));</span>
<span class="fc" id="L323">            l.setAutore(listaL.get(4));</span>
<span class="fc" id="L324">            l.setLingua(listaL.get(5));</span>
<span class="fc" id="L325">            l.setCategoria(listaL.get(6));</span>
<span class="fc" id="L326">            l.setDataPubb(LocalDate.parse(listaL.get(7)));</span>
<span class="fc" id="L327">            l.setRecensione(listaL.get(8));</span>
<span class="fc" id="L328">            l.setNrCopie(Integer.parseInt(listaL.get(9)));</span>
<span class="fc" id="L329">            l.setDesc(listaL.get(10));</span>
<span class="fc" id="L330">            l.setDisponibilita(Integer.parseInt(listaL.get(11)));</span>
<span class="fc" id="L331">            l.setPrezzo(Float.parseFloat(listaL.get(12)));</span>
<span class="fc" id="L332">            l.setId(Integer.parseInt(listaL.get(13)));</span>
<span class="fc" id="L333">            return l;</span>

    }

    private static @NotNull Rivista getRivista(int i) throws IOException{


            String line;


<span class="fc" id="L343">            ArrayList&lt;String&gt; listaR = new ArrayList&lt;&gt;();</span>


<span class="fc" id="L346">            try (FileReader fileReader = new FileReader(&quot;src/main/resources/tmpFiles/rivista&quot; + i + &quot;.txt&quot;);</span>
<span class="fc" id="L347">                 BufferedReader bufferedReader = new BufferedReader(fileReader)) {</span>
<span class="fc bfc" id="L348" title="All 2 branches covered.">                while ((line = bufferedReader.readLine()) != null) {</span>
<span class="fc" id="L349">                    listaR.add(line);</span>

                }
            }



<span class="fc" id="L356">                Rivista r=new Rivista();</span>
<span class="fc" id="L357">                r.setTitolo(listaR.get(0));</span>
<span class="fc" id="L358">                r.setCategoria(listaR.get(1));</span>
<span class="fc" id="L359">                r.setAutore(listaR.get(2));</span>
<span class="fc" id="L360">                r.setLingua(listaR.get(3));</span>
<span class="fc" id="L361">                r.setEditore(listaR.get(4));</span>
<span class="fc" id="L362">                r.setDescrizione(listaR.get(5));</span>
<span class="fc" id="L363">                r.setDataPubb(LocalDate.parse(listaR.get(6)));</span>
<span class="fc" id="L364">                r.setDisp(Integer.parseInt(listaR.get(7)));</span>
<span class="fc" id="L365">                r.setPrezzo(Float.parseFloat(listaR.get(8)));</span>
<span class="fc" id="L366">                r.setCopieRim(Integer.parseInt(listaR.get(9)));</span>
<span class="fc" id="L367">                r.setId(Integer.parseInt(listaR.get(10)));</span>
<span class="fc" id="L368">                return r;</span>



            }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>